{% extends 'department/index.html' %}
{% block content %}
<style>
    /* --- PAGE HEADER --- */
    .page-header {
    padding: 15px 20px 8px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e0e0e0;
    background-color: #f9f9f9;
}

.page-title h2 {
    margin: 0 0 3px 0;
    font-size: 22px;
    font-weight: 600;
    color: #2c3e50;
}

.page-title .small {
    font-size: 12px;
    color: #7f8c8d;
}

/* --- SEARCH BAR --- */
.search-container {
    padding: 15px;
    background: #fff;
    margin-bottom: 15px;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.search-form {
    display: flex;
    gap: 8px;
    align-items: center;
}

.search-form label {
    font-weight: 500;
    color: #34495e;
    white-space: nowrap;
}

.search-form input[type="text"] {
    flex-grow: 1;
    padding: 8px 12px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 13px;
}

.search-form button {
    padding: 8px 16px;
    background-color: #dc3545;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
    transition: background-color 0.2s;
}

.search-form button:hover {
    background-color: #c82333;
}

/* --- DOCUMENT INFO & HISTORY --- */
.tracking-details-container {
    padding: 0 15px 15px 15px;
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
}

.doc-info, .tracking-history {
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

/* Document info grid */
.doc-info-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px 8px;
    font-size: 13px;
}

.info-item div:first-child {
    font-size: 11px;
    color: #7f8c8d;
    font-weight: 500;
    text-transform: uppercase;
}

.info-item div:last-child {
    font-weight: 600;
    color: #34495e;
}

/* Current status badge */
.current-status-badge {
    padding: 3px 6px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    background-color: #fff3cd;
    color: #664d03;
    border: 1px solid #ffecb5;
}

/* --- TRACKING HISTORY TIMELINE --- */
.tracking-history h3 {
    font-size: 16px;
    margin: 0 0 8px 0;
    border-bottom: 1px solid #f0f0f0;
    padding-bottom: 6px;
    color: #2c3e50;
}

.timeline {
    position: relative;
    padding-left: 20px;
    margin-left: 10px;
}

.timeline::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 2px;
    height: 100%;
    background: #e0e0e0;
}

.timeline-item {
    position: relative;
    margin-bottom: 15px;
    padding-left: 18px;
}

.timeline-item:last-child {
    margin-bottom: 0;
}

.timeline-item .circle {
    position: absolute;
    top: 0;
    left: -3px;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #dc3545;
    border: 2px solid #fff;
    z-index: 1;
}

.timeline-item.completed .circle { background: #198754; }
.timeline-item.pending .circle { background: #ffc107; }

.timeline-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    font-size: 13px;
}

.timeline-info {
    flex-grow: 1;
}

.timeline-title {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 2px;
}

.timeline-details {
    color: #555;
    font-size: 12px;
}

.timeline-date {
    color: #7f8c8d;
    font-size: 11px;
    white-space: nowrap;
}

/* --- ALL DOCUMENTS TABLE --- */
.all-docs-section {
    padding: 15px;
}

.all-docs-section h3 {
    font-size: 18px;
    margin: 0 0 10px 0;
    color: #2c3e50;
}

.table-wrapper {
    overflow-x: auto;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

table {
    width: 100%;
    border-collapse: collapse;
    min-width: 900px;
}

th, td {
    padding: 10px 12px;
    font-size: 13px;
    color: #34495e;
    border-bottom: 1px solid #f0f0f0;
}

th {
    background-color: #ecf0f1;
    font-weight: 600;
    color: #2c3e50;
    text-transform: uppercase;
    font-size: 12px;
}

tr:nth-child(odd) { background-color: #fcfcfc; }
tr:hover { background-color: #f1f1f1; }

.status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 500;
    display: inline-block;
    text-align: center;
}

.s-mayor { background-color: #fff3cd; color: #664d03; border: 1px solid #ffecb5; }
.s-bac { background-color: #cff4fc; color: #055160; border: 1px solid #cff4fc; }
.s-accounting { background-color: #d1e7dd; color: #0f5132; border: 1px solid #d1e7dd; }
.s-processing { background-color: #f8d7da; color: #842029; border: 1px solid #f8d7da; }
.s-pr { background-color: #cfe2ff; color: #084298; border: 1px solid #cfe2ff; }

@media (max-width: 768px) {
    .doc-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<div class="page-header">
    <div class="page-title">
        <h2>Document Tracking</h2>
        <div class="small">Track the status and location of documents</div>
    </div>
</div>

<div class="search-container">
    <form class="search-form" onsubmit="event.preventDefault(); trackDocument();">
        <label for="docNumber">Track Document</label>
        <input type="text" id="docNumberInput" placeholder="e.g., DOC-2025-001" value="DOC-2025-001" required>
        <button type="submit">Track</button>
    </form>
</div>

<div class="tracking-details-container">
        <div id="trackedDocDetails">
            </div>
</div>

<div class="all-docs-section">
    <h3>All Documents Status</h3>
    <div class="table-wrapper">
        <table id="allDocsTable">
            <thead>
                <tr>
                    <th>Doc Number</th>
                    <th>Title</th>
                    <th>Implementing Office</th>
                    <th>Released By</th>
                    <th>Received By</th>
                    <th>Status</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                            </tbody>
        </table>
    </div>
</div>

<script>
// --- Sample Data ---

const documentsData = [
    { 
        docNumber: "DOC-2025-001", 
        title: "Budget Request for Q1 2025", 
        type: "SVP", 
        implementingOffice: "Budget Office", 
        releasedBy: "John Doe", 
        receivedBy: "Jane Smith", 
        dateReceived: "2025-01-15",
        currentStatus: "For Signature Mayor",
        statusClass: "s-mayor",
        history: [
            { title: "Document Received", by: "Jane Smith", office: "Budget Office", status: "completed", date: "2025-01-15" },
            { title: "For Signature Mayor", by: "John Doe", office: "Budget Office", status: "current", date: "2025-02-07" },
            { title: "Awaiting Next Action", by: "N/A", office: "Budget Office", status: "pending", date: null }
        ]
    },
    { 
        docNumber: "DOC-2025-002", 
        title: "Road Construction Bidding", 
        type: "BIDDING", 
        implementingOffice: "Engineering Office", 
        releasedBy: "Mark Johnson", 
        receivedBy: "Sarah Williams", 
        dateReceived: "2025-01-18",
        currentStatus: "For Signatures of BAC Members - BAC Office",
        statusClass: "s-bac",
        history: [
            { title: "Document Received", by: "Sarah Williams", office: "Engineering Office", status: "completed", date: "2025-01-18" },
            { title: "For BAC Review", by: "Mark Johnson", office: "BAC Office", status: "current", date: "2025-02-01" },
            { title: "Approval Awaited", by: "N/A", office: "BAC Office", status: "pending", date: null }
        ]
    },
    { 
        docNumber: "DOC-2025-003", 
        title: "Diesel Reimbursement - Agriculture", 
        type: "REIMBURSEMENT OF DIESEL", 
        implementingOffice: "Agriculture Office", 
        releasedBy: "Robert Brown", 
        receivedBy: "Emily Davis", 
        dateReceived: "2025-01-20",
        currentStatus: "For Accounting Staff Validation",
        statusClass: "s-accounting",
        history: [
            { title: "Document Filed", by: "Robert Brown", office: "Agriculture Office", status: "completed", date: "2025-01-20" },
            { title: "For Staff Validation", by: "Emily Davis", office: "Accounting Office", status: "current", date: "2025-01-22" },
            { title: "Payment Preparation", by: "N/A", office: "Treasury Office", status: "pending", date: null }
        ]
    },
    { 
        docNumber: "DOC-2025-004", 
        title: "Medical Assistance - Patient A", 
        type: "MEDICAL ASSISTANCE", 
        implementingOffice: "Municipal Health Office", 
        releasedBy: "Dr. Michael Wilson", 
        receivedBy: "Nurse Maria Garcia", 
        dateReceived: "2025-01-22",
        currentStatus: "For Processing",
        statusClass: "s-processing",
        history: [
            { title: "Filed and Received", by: "Nurse Maria Garcia", office: "Municipal Health Office", status: "completed", date: "2025-01-22" },
            { title: "For Processing", by: "Dr. Michael Wilson", office: "Municipal Health Office", status: "current", date: "2025-01-23" },
            { title: "Awaiting Release", by: "N/A", office: "Municipal Health Office", status: "pending", date: null }
        ]
    },
    { 
        docNumber: "DOC-2025-005", 
        title: "Campaign Tarpaulin Reimbursement", 
        type: "REIMBURSEMENT OF TARPAULIN", 
        implementingOffice: "Mayor Office", 
        releasedBy: "Mayor Rodriguez", 
        receivedBy: "Admin Staff", 
        dateReceived: "2025-01-25",
        currentStatus: "Request for PR",
        statusClass: "s-pr",
        history: [
            { title: "Document Received", by: "Admin Staff", office: "Mayor Office", status: "completed", date: "2025-01-25" },
            { title: "Request for PR", by: "Mayor Rodriguez", office: "Mayor Office", status: "current", date: "2025-01-26" },
            { title: "Awaiting PR Number", by: "N/A", office: "GSO", status: "pending", date: null }
        ]
    }
];

// --- Rendering Functions ---

function getStatusBadgeHtml(status, className) {
    return `<span class="status-badge ${className}">${status}</span>`;
}

function renderAllDocsTable() {
    const tbody = document.getElementById("allDocsTable").querySelector("tbody");
    tbody.innerHTML = "";

    documentsData.forEach(doc => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${doc.docNumber}</td>
            <td>${doc.title}</td>
            <td>${doc.implementingOffice}</td>
            <td>${doc.releasedBy}</td>
            <td>${doc.receivedBy}</td>
            <td>${getStatusBadgeHtml(doc.currentStatus, doc.statusClass)}</td>
            <td>${doc.dateReceived}</td>
        `;
        tbody.appendChild(tr);
    });
}

function renderTrackedDocument(doc) {
    const detailsContainer = document.getElementById("trackedDocDetails");
    if (!doc) {
        detailsContainer.innerHTML = `<div style="text-align: center; padding: 50px; color: #7f8c8d; background: #fff; border-radius: 8px;">Document not found. Please enter a valid Document Number.</div>`;
        return;
    }

    const statusBadge = getStatusBadgeHtml(doc.currentStatus, doc.statusClass);

    // 1. Document Information Section
    let infoHtml = `
        <div class="doc-info">
            <h3>Document Information</h3>
            <div class="doc-info-grid">
                <div class="info-item"><div>Document Number</div><div>${doc.docNumber}</div></div>
                <div class="info-item"><div>Title</div><div>${doc.title}</div></div>
                <div class="info-item"><div>Type</div><div>${doc.type}</div></div>

                <div class="info-item"><div>Implementing Office</div><div>${doc.implementingOffice}</div></div>
                <div class="info-item"><div>Released By</div><div>${doc.releasedBy}</div></div>
                <div class="info-item"><div>Received By</div><div>${doc.receivedBy}</div></div>
                
                <div class="info-item"><div>Current Status</div><div><span class="current-status-badge">${doc.currentStatus}</span></div></div>
                <div class="info-item"><div>Date Received</div><div>${doc.dateReceived}</div></div>
            </div>
        </div>
    `;
    
    // 2. Tracking History Section
    let historyHtml = `
        <div class="tracking-history">
            <h3>Tracking History</h3>
            <div class="timeline">
                ${doc.history.map(item => `
                    <div class="timeline-item ${item.status}">
                        <span class="circle"></span>
                        <div class="timeline-content">
                            <div class="timeline-info">
                                <div class="timeline-title">${item.title}</div>
                                <div class="timeline-details">
                                    ${item.office} <span style="color:#2c3e50; font-weight:500;">By ${item.by}</span>
                                </div>
                            </div>
                            <div class="timeline-date">${item.date || ''}</div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;

    detailsContainer.innerHTML = infoHtml + historyHtml;
}

function trackDocument() {
    const docNumber = document.getElementById("docNumberInput").value.trim().toUpperCase();
    const foundDoc = documentsData.find(doc => doc.docNumber === docNumber);
    renderTrackedDocument(foundDoc);
}

// Initial load: Render the All Documents Table and track the first document (DOC-2025-001)
document.addEventListener('DOMContentLoaded', () => {
    renderAllDocsTable();
    trackDocument();
});
</script>
{% endblock %}