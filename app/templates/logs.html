{% extends 'index.html' %}
{% block content %}
<style>
.log-container { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
.log-filters { display: flex; gap: 10px; margin-bottom: 20px; }
.log-filters select { padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; }
.log-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
.log-table th, .log-table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; font-size: 13px; }
.log-table th { background: #f1f3f5; font-weight: 600; text-transform: uppercase; }
.log-table tr:hover { background: #f9f9f9; }
.action-badge { display: inline-block; padding: 3px 8px; border-radius: 3px; font-size: 11px; font-weight: 600; }
.action-create { background: #d1e7dd; color: #0f5132; }
.action-edit { background: #cfe2ff; color: #084298; }
.action-delete { background: #f8d7da; color: #842029; }
.action-transfer { background: #fff3cd; color: #664d03; }
.action-close { background: #e2e3e5; color: #383d41; }
</style>

<div class="content">
  <h1 class="dashboard-title">Activity Logs</h1>
  <p>System activity audit trail for {{ current_user.department }}.</p>

  <div class="log-filters">
    <select id="actionFilter" onchange="filterLogs()">
      <option value="">All Actions</option>
      <option value="create">Create</option>
      <option value="edit">Edit</option>
      <option value="delete">Delete</option>
      <option value="transfer">Transfer</option>
      <option value="close">Close</option>
    </select>
  </div>

  <div class="log-container">
    <table class="log-table" id="logTable">
      <thead>
        <tr>
          <th>Timestamp</th>
          <th>Action</th>
          <th>Document</th>
          <th>Department</th>
          <th>User</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for h in records|sort(attribute='timestamp', reverse=True) %}
        <tr data-action="{{ h.action_type|lower }}">
          <td>{{ h.timestamp.strftime('%Y-%m-%d %H:%M:%S') if h.timestamp and h.timestamp is not string else h.timestamp }}</td>
          <td>
            <span class="action-badge action-{{ h.action_type|lower }}">{{ h.action_type|upper }}</span>
          </td>
          <td>{{ h.record.document_id if h.record else '-' }}</td>
          <td>{{ h.from_department or h.to_department or '-' }}</td>
          <td>{{ h.action_by or '-' }}</td>
          <td>{{ h.status }}</td>
        </tr>
        {% else %}
        <tr><td colspan="6" style="text-align:center;color:#999;padding:40px;">No activity logs found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
function filterLogs() {
  const filter = document.getElementById('actionFilter').value.toLowerCase();
  const rows = document.querySelectorAll('#logTable tbody tr');
  rows.forEach(row => {
    const action = row.dataset.action || '';
    row.style.display = (filter === '' || action.includes(filter)) ? '' : 'none';
  });
}
</script>

{% endblock %}
