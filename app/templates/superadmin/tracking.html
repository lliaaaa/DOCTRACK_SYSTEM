{% extends 'superadmin/index.html' %}
{% block content %}

<style>
/* --- Existing styles omitted for brevity --- */

/* --- SEARCH BAR --- */
.search-container {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    margin-bottom: 15px;
    gap: 10px;
}

.search-container input[type="text"] {
    padding: 8px 12px;
    width: 250px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 13px;
}

.search-container button {
    padding: 8px 16px;
    border: none;
    background-color: #007bff;
    color: #fff;
    font-weight: 600;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s;
}

.search-container button:hover {
    background-color: #0056b3;
}

.page-header {
    padding: 15px 20px 8px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e0e0e0;
    background-color: #f9f9f9;
}

.page-title h2 { margin: 0 0 3px 0; font-size: 22px; font-weight: 600; color: #2c3e50; }
.page-title .small { font-size: 12px; color: #7f8c8d; }

/* --- DOCUMENT INFO & HISTORY --- */
.tracking-details-container {
    padding: 0 15px 15px 15px;
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
}

.doc-info, .tracking-history {
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.doc-info-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px 8px;
    font-size: 13px;
}

.info-item div:first-child { font-size: 11px; color: #7f8c8d; font-weight: 500; text-transform: uppercase; }
.info-item div:last-child { font-weight: 600; color: #34495e; }

.current-status-badge {
    padding: 3px 6px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    background-color: #fff3cd;
    color: #664d03;
    border: 1px solid #ffecb5;
}

.tracking-history h3 { font-size: 16px; margin: 0 0 8px 0; border-bottom: 1px solid #f0f0f0; padding-bottom: 6px; color: #2c3e50; }

.timeline { position: relative; padding-left: 20px; margin-left: 10px; }
.timeline::before { content: ''; position: absolute; top: 0; left: 0; width: 2px; height: 100%; background: #e0e0e0; }
.timeline-item { position: relative; margin-bottom: 15px; padding-left: 18px; }
.timeline-item:last-child { margin-bottom: 0; }
.timeline-item .circle { position: absolute; top: 0; left: -3px; width: 10px; height: 10px; border-radius: 50%; background: #dc3545; border: 2px solid #fff; z-index: 1; }
.timeline-item.completed .circle { background: #198754; }
.timeline-item.pending .circle { background: #ffc107; }
.timeline-content { display: flex; justify-content: space-between; align-items: flex-start; font-size: 13px; }
.timeline-info { flex-grow: 1; }
.timeline-title { font-weight: 600; color: #2c3e50; margin-bottom: 2px; }
.timeline-details { color: #555; font-size: 12px; }
.timeline-date { color: #7f8c8d; font-size: 11px; white-space: nowrap; }

/* --- ALL DOCUMENTS TABLE --- */
.all-docs-section { padding: 15px; }
.all-docs-section h3 { font-size: 18px; margin: 0 0 10px 0; color: #2c3e50; }
.table-wrapper { overflow-x: auto; background: #fff; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
table { width: 100%; border-collapse: collapse; min-width: 900px; }
th, td { padding: 10px 12px; font-size: 13px; color: #34495e; border-bottom: 1px solid #f0f0f0; text-align: center; }
th { background-color: #ecf0f1; font-weight: 600; color: #2c3e50; text-transform: uppercase; font-size: 12px; }
tr:nth-child(odd) { background-color: #fcfcfc; }
tr:hover { background-color: #f1f1f1; }

.status-badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 500; display: inline-block; text-align: center; }
.s-mayor { background-color: #fff3cd; color: #664d03; border: 1px solid #ffecb5; }
.s-bac { background-color: #cff4fc; color: #055160; border: 1px solid #cff4fc; }
.s-accounting { background-color: #d1e7dd; color: #0f5132; border: 1px solid #d1e7dd; }
.s-processing { background-color: #f8d7da; color: #842029; border: 1px solid #f8d7da; }
.s-pr { background-color: #cfe2ff; color: #084298; border: 1px solid #cfe2ff; }

@media (max-width: 768px) {
    .doc-info-grid { grid-template-columns: 1fr; }
}

/* --- SEARCH BAR --- */
.search-container {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    margin-bottom: 15px;
    gap: 10px;
}

.search-container input[type="text"] {
    padding: 8px 12px;
    width: 250px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 13px;
}

.search-container button {
    padding: 8px 16px;
    border: none;
    background-color: #007bff;
    color: #fff;
    font-weight: 600;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s;
}

.search-container button:hover {
    background-color: #0056b3;
}
</style>

<div class="page-header">
    <div class="page-title">
        <h2>Document Tracking</h2>
        <div class="small">Track the status and location of documents</div>
    </div>
</div>

<div class="all-docs-section">
    <h3>Trace Document</h3>
    <form class="search-container" method="GET" action="{{ url_for('main.superadmin_trace') }}">
        <input type="text" name="q" placeholder="Enter keyword or Document ID" value="{{ request.args.get('q', '') }}">
        <button type="submit">Trace</button>
    </form>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Document ID</th>
                    <th>Title</th>
                    <th>Type</th>
                    <th>Department</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% if request.args.get('q') %}
                    {% set ns = namespace(found=false) %}
                    {% for doc in documents %}
                        {% if request.args.get('q').lower() in doc.document_id.lower() or request.args.get('q').lower() in doc.title.lower() %}
                            {% set ns.found = true %}
                            <tr>
                                <td>{{ doc.document_id }}</td>
                                <td>{{ doc.title }}</td>
                                <td>{{ doc.doc_type }}</td>
                                <td>{{ doc.department }}</td>
                                <td><span class="status-badge s-{{ doc.department|lower }}">{{ doc.status }}</span></td>
                                <td><a href="{{ url_for('main.superadmin_trace', id=doc.document_id) }}">Trace</a></td>
                            </tr>
                        {% endif %}
                    {% endfor %}

                    {% if not ns.found %}
                        <tr>
                            <td colspan="6">No documents matched your search.</td>
                        </tr>
                    {% endif %}
                {% else %}
                    <tr>
                        <td colspan="6">Content not available. Please search or select a document.</td>
                    </tr>
                {% endif %}

            </tbody>

        </table>
    </div>
</div>

{% endblock %}
